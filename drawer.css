/* drawer.css â€” Bare minimum, nested support */

:root {
  --drawer-bg: #fff;
  --drawer-radius: 24px;
  --drawer-max-height: 96dvh;
  --drawer-backdrop: hsl(0 0% 0% / 0.4);
  --drawer-duration: 0.5s;
  --drawer-ease: cubic-bezier(0.32, 0.72, 0, 1);
}

/* Background scale */
body:has(dialog.drawer[open]) {
  overflow: hidden;
  scale: 0.94;
  border-radius: var(--drawer-radius);
  transition: scale var(--drawer-duration) var(--drawer-ease);
  transform-origin: center top;
}

/* Base drawer */
dialog.drawer {
  border: none;
  padding: 0;
  margin: 0 auto;
  position: fixed;
  inset: auto 0 0 0;
  width: 100%;
  max-width: 500px;
  max-height: var(--drawer-max-height);
  background: var(--drawer-bg);
  border-radius: var(--drawer-radius) var(--drawer-radius) 0 0;
  box-shadow: 0 -10px 50px hsl(0 0% 0% / 0.12);
  overflow: hidden;
  opacity: 0;
  translate: 0 100%;
  transition:
    display var(--drawer-duration) allow-discrete,
    overlay var(--drawer-duration) allow-discrete,
    translate var(--drawer-duration) var(--drawer-ease),
    opacity 0.2s;
}

dialog.drawer::backdrop {
  background: var(--drawer-backdrop);
  backdrop-filter: blur(4px);
  opacity: 0;
  transition:
    display var(--drawer-duration) allow-discrete,
    overlay var(--drawer-duration) allow-discrete,
    opacity 0.2s;
}

dialog.drawer[open] { opacity: 1; translate: 0 0; }
dialog.drawer[open]::backdrop { opacity: 1; }

@starting-style {
  dialog.drawer[open] { opacity: 0; translate: 0 100%; }
  dialog.drawer[open]::backdrop { opacity: 0; }
}

/* Nested stacking */
dialog.drawer[data-level="1"]:has(~ dialog.drawer[data-level="2"][open]) {
  scale: 0.94;
  translate: 0 -20px;
  filter: brightness(0.94);
  pointer-events: none;
}

dialog.drawer[data-level="2"]:has(~ dialog.drawer[data-level="3"][open]) {
  scale: 0.94;
  translate: 0 -20px;
  filter: brightness(0.94);
  pointer-events: none;
}

dialog.drawer[data-level="1"]:has(~ dialog.drawer[data-level="2"][open] ~ dialog.drawer[data-level="3"][open]) {
  scale: 0.88;
  translate: 0 -40px;
  filter: brightness(0.88);
}

dialog.drawer[data-level="2"]::backdrop,
dialog.drawer[data-level="3"]::backdrop {
  background: hsl(0 0% 0% / 0.15);
  backdrop-filter: none;
}

/* Content area */
.drawer-content {
  padding: 1.5rem;
  padding-bottom: calc(1.5rem + env(safe-area-inset-bottom, 0));
  overflow-y: auto;
  overscroll-behavior: contain;
  max-height: calc(var(--drawer-max-height) - 20px);
}

/* Handle */
.drawer-handle {
  display: flex;
  justify-content: center;
  padding: 1rem 0 0.5rem;
}

.drawer-handle::before {
  content: '';
  width: 48px;
  height: 5px;
  background: hsl(0 0% 80%);
  border-radius: 100px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { transition-duration: 0.01ms !important; }
  body:has(dialog.drawer[open]) { scale: 1; }
}
